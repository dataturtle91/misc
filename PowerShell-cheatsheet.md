# üìò PowerShell ‚Äì rozszerzona ≈õciƒÖga dla poczƒÖtkujƒÖcych (PL)

> Celem tej ≈õciƒÖgi jest daƒá Ci **praktyczny, skondensowany** przeglƒÖd wszystkiego, co trzeba znaƒá, aby wygodnie pracowaƒá w PowerShell na poziomie podstawowym (i trochƒô ponad). Ka≈ºdy blok mo≈ºesz wkleiƒá do konsoli lub skryptu.

---

## 1) Start: uruchamianie i pomoc

**Uruchamianie konsoli**
- Windows: *PowerShell 7 (pwsh)* lub *Windows PowerShell 5.1 (powershell)*
- Sprawd≈∫ wersjƒô:  
  ```powershell
  $PSVersionTable
  ```

**Wykonywanie skrypt√≥w (Execution Policy)**
- Domy≈õlnie mo≈ºe blokowaƒá uruchamianie skrypt√≥w `.ps1`
- Ustaw dla bie≈ºƒÖcego u≈ºytkownika (zalecane):
  ```powershell
  Set-ExecutionPolicy -Scope CurrentUser RemoteSigned
  ```

**Pomoc**
```powershell
Get-Help Get-Process         # skr√≥cony opis
Get-Help Get-Process -Detailed
Get-Help Get-Process -Examples
Update-Help -UICulture pl-PL # pobierz/od≈õwie≈º pomoc (wymaga Internetu)
```

**Znajdowanie komend**
```powershell
Get-Command *service*        # wyszukaj polecenia
Get-Command -Module Microsoft.PowerShell.Management
```

---

## 2) Skrypty i profil

**Plik skryptu**: `myscript.ps1`  
**Uruchomienie**:  
```powershell
.\myscript.ps1    # w bie≈ºƒÖcym katalogu
```

**Parametry skryptu**
```powershell
param(
  [string]$Path = ".",
  [switch]$Recurse
)

Get-ChildItem -Path $Path -File -Recurse:$Recurse
```

**Profil (auto‚Äë≈Çadowany przy starcie)**
```powershell
$PROFILE          # ≈õcie≈ºka do profilu
Test-Path $PROFILE
New-Item -ItemType File -Path $PROFILE -Force
# Dodaj aliasy, funkcje, import modu≈Ç√≥w, ustawienia PSReadLine itd.
```

---

## 3) Zmienne, typy, stringi

**Podstawy**
```powershell
$x = 10
$y = "tekst"
$pi = [math]::PI
$type = $x.GetType().FullName
```

**Interpolacja i ≈ÇƒÖczenie napis√≥w**
```powershell
$name = "Bartosz"
"Hello $name"                # interpolacja w ""
'Hello $name'                # bez interpolacji w ''
"Plik: $($env:TEMP)\log.txt" # wstawka wyra≈ºenia
```

**Here‚Äëstring (wielolinijkowe)**
```powershell
@"
Linia 1
Linia 2 z $name
"@
```

**Konwersje typ√≥w**
```powershell
[int]"42"
[datetime]"2025-09-20"
[bool]"true"
```

**Zmienne ≈õrodowiskowe**
```powershell
$env:PATH
$env:MY_VAR = "abc"
```

---

## 4) Operatory

**Por√≥wnania (niezale≈ºne od wielko≈õci liter domy≈õlnie)**
```powershell
$A -eq $B      # r√≥wne
$A -ne $B      # r√≥≈ºne
$A -gt 5       # >
$A -ge 5       # >=
$A -lt 5       # <
$A -le 5       # <=
"abc" -like "a*"
"abc" -match "^a\w+"   # regex
```

**Logiczne**
```powershell
($x -gt 5) -and ($y -lt 10)
($a -eq 1) -or ($b -eq 2)
-not ($cond)
```

**Inne przydatne**
```powershell
1..5            # zakres
"abc" * 3       # powt√≥rz
12345 -as [string]   # konwersja "bezpieczna"
```

---

## 5) Kolekcje: tablice, hashtabele, obiekty

**Tablice**
```powershell
$arr = 1,2,3
$arr[0]               # pierwszy element
$arr += 4             # dodaj
$arr.Count
```

**Hashtabele (s≈Çowniki)**
```powershell
$h = @{
  Name = "Ala"
  Age  = 30
}
$h.Name
$h["Age"] = 31
```

**Obiekty niestandardowe (rekordy)**
```powershell
[PSCustomObject]@{ Name="Ala"; Age=31; City="Krak√≥w" }
```

**Kolekcje generyczne (wydajniejsze mutacje)**
```powershell
$list = [System.Collections.Generic.List[int]]::new()
$list.Add(1); $list.Add(2)
```

---

## 6) Pipeline ‚Äì serce PowerShella

**Sk≈Çadnia i my≈õlenie ‚Äûobiektami‚Äù**
```powershell
Get-Process | Where-Object { $_.CPU -gt 100 } | Sort-Object CPU -Descending | Select-Object -First 5 Name, CPU
```

**Najczƒôstsze ogniwa pipeline‚Äôu**
```powershell
Where-Object { $_.Prop -gt 0 }
Select-Object Name, Id
Select-Object @{Name="MB";Expression={ $_.WorkingSet/1MB -as [int] }}
Sort-Object Prop -Descending
Group-Object Prop
Measure-Object -Property Size -Sum -Average -Maximum -Minimum
```

**Uwaga**: `Format-Table`/`Format-List` na ko≈Ñcu ‚Äì do wy≈õwietlenia. Nie przekazuj dalej sformatowanych obiekt√≥w, je≈õli chcesz je jeszcze obrabiaƒá.

---

## 7) Warunki i pƒôtle

**If / ElseIf / Else**
```powershell
if ($x -gt 10) { "du≈ºe" }
elseif ($x -eq 10) { "r√≥wne" }
else { "ma≈Çe" }
```

**Switch (tak≈ºe regex)**
```powershell
switch -Regex ("file1.txt","img_001.png") {
  '^img_' { "obrazek: $_" }
  '\.txt$' { "tekst: $_" }
  default { "inne: $_" }
}
```

**Pƒôtle**
```powershell
foreach ($i in 1..5) { $i }
for ($i=0; $i -lt 5; $i++) { $i }
while ($true) { break }
do { $i++ } while ($i -lt 10)
```

**Kontrola**: `break`, `continue`

---

## 8) Funkcje i parametry (tak≈ºe ‚Äûadvanced functions‚Äù)

**Prosta funkcja**
```powershell
function Square($x) { $x * $x }
```

**Parametry z typami i warto≈õciami domy≈õlnymi**
```powershell
function Get-TopCpu {
  param(
    [int]$Top = 5
  )
  Get-Process | Sort-Object CPU -Descending | Select-Object -First $Top Name, CPU
}
```

**Advanced function (CmdletBinding) + walidacja + pipeline**  
```powershell
function Get-BigFiles {
  [CmdletBinding()]
  param(
    [Parameter(Mandatory, ValueFromPipeline, ValueFromPipelineByPropertyName)]
    [Alias("FullName")]
    [string]$Path,

    [ValidateRange(1MB, 1000GB)]
    [long]$MinSize = 100MB
  )
  process {
    Get-ChildItem -Path $Path -File -Recurse -ErrorAction SilentlyContinue |
      Where-Object { $_.Length -ge $MinSize }
  }
}
```

**Splatting (przekazywanie parametr√≥w hashtable‚Äôem)**
```powershell
$params = @{
  Path = "."
  Filter = "*.log"
  Recurse = $true
}
Get-ChildItem @params
```

---

## 9) B≈Çƒôdy i logowanie

**Try / Catch / Finally**
```powershell
try {
  Get-Content "nie-istnieje.txt" -ErrorAction Stop
}
catch {
  Write-Warning "B≈ÇƒÖd: $($_.Exception.Message)"
}
finally {
  "SprzƒÖtanie..."
}
```

**Poziomy komunikat√≥w**
```powershell
Write-Host "Info"
Write-Verbose "Szczeg√≥≈Çy"       # poka≈ºe siƒô z prze≈ÇƒÖcznikiem -Verbose
Write-Debug "Debug"             # poka≈ºe siƒô z -Debug
Write-Warning "Uwaga"
Write-Error "B≈ÇƒÖd"
```

**Sterowanie b≈Çƒôdami**
```powershell
$ErrorActionPreference = "Stop"   # domy≈õlnie: Continue
Get-Item foo: -ErrorAction SilentlyContinue
```

---

## 10) Pliki i foldery (I/O)

**PrzeglƒÖdanie**
```powershell
Get-ChildItem -Path C:\ -Directory
Get-ChildItem -Path . -Recurse -File -Filter *.log
```

**Tworzenie / kopiowanie / przenoszenie / usuwanie**
```powershell
New-Item -ItemType Directory -Path .\out
Copy-Item .\a.txt .\out\a.txt -Force
Move-Item .\out\a.txt .\a2.txt -Force
Remove-Item .\a2.txt -Force
```

**Czytanie / zapis**
```powershell
Get-Content .\in.txt -TotalCount 5
Set-Content .\out.txt "Linia 1" -Encoding utf8
Add-Content .\out.txt "Dopisane"
Out-File .\report.txt -Width 200 -Encoding utf8BOM
```

**Znajd≈∫ i usu≈Ñ pliki starsze ni≈º X dni**
```powershell
$days = 365
Get-ChildItem -Path "C:\Logs" -File -Recurse |
  Where-Object { $_.LastWriteTime -lt (Get-Date).AddDays(-$days) } |
  Remove-Item -Force -ErrorAction SilentlyContinue
```

**Archiwizacja**
```powershell
Compress-Archive -Path .\logs\* -DestinationPath .\logs.zip -Force
Expand-Archive .\logs.zip -DestinationPath .\unzipped -Force
```

---

## 11) CSV, JSON, XML

**CSV**
```powershell
$df = Import-Csv .\dane.csv
$df | Where-Object { $_.age -gt 30 } | Sort-Object age -Descending |
  Export-Csv .\out.csv -NoTypeInformation -Encoding UTF8
```

**JSON**
```powershell
$json = Get-Content .\config.json -Raw | ConvertFrom-Json
$json.ApiKey
# Zapis
$config = [PSCustomObject]@{ ApiKey="KEY"; Enabled=$true }
$config | ConvertTo-Json -Depth 5 | Set-Content .\config.json -Encoding utf8
```

**XML (prosto)**
```powershell
[xml]$xml = Get-Content .\data.xml
$xml.root.item[0].name
```

---

## 12) Sieƒá i HTTP

**Proste pobieranie stron/pliku**
```powershell
Invoke-WebRequest "https://example.com" -OutFile .\index.html
```

**REST API**
```powershell
Invoke-RestMethod -Uri "https://api.example.com/items" -Headers @{Authorization="Bearer $token"}
# POST z JSON
$body = @{ name="test"; enabled=$true } | ConvertTo-Json
Invoke-RestMethod -Method Post -Uri "https://api.example.com/items" -Body $body -ContentType "application/json"
```

**DNS, ping, traceroute**
```powershell
Resolve-DnsName microsoft.com
Test-Connection 8.8.8.8 -Count 2
Test-NetConnection github.com -TraceRoute
```

---

## 13) Procesy, us≈Çugi, rejestr

**Procesy**
```powershell
Get-Process | Sort-Object CPU -Descending | Select-Object -First 10 Name, CPU, Id
Stop-Process -Id 1234 -Force
```

**Us≈Çugi**
```powershell
Get-Service | Where-Object { $_.Status -eq "Running" }
Restart-Service -Name Spooler
```

**Rejestr (provider)**
```powershell
Get-ChildItem HKLM:\Software
Get-ItemProperty "HKCU:\Software\MojaApp"
```

---

## 14) Modu≈Çy i pakiety

**Praca z modu≈Çami**
```powershell
Get-Module               # za≈Çadowane
Get-Module -ListAvailable
Install-Module Posh-SSH  # z PSGallery (wymaga zaufania repo)
Import-Module Posh-SSH
Remove-Module Posh-SSH
```

**Sprawdzenie repozytori√≥w galerii**
```powershell
Get-PSRepository
Register-PSRepository -Name MyRepo -SourceLocation "https://..."
```

---

## 15) Zdalne wykonywanie (remoting)

> W PowerShell 7 remoting po WinRM lub SSH.

**WinRM (na Windows)**
```powershell
Enable-PSRemoting -Force                 # na ho≈õcie docelowym (admin)
Enter-PSSession -ComputerName SERVER01   # interakcja
Invoke-Command -ComputerName SERVER01 -ScriptBlock { Get-Process }
```

**SSH remoting (PS7)**
```powershell
Enter-PSSession -HostName srv -User bob
Invoke-Command -HostName srv -User bob -ScriptBlock { hostname }
```

---

## 16) Zadania w tle i planowanie

**Joby**
```powershell
$job = Start-Job { Start-Sleep -Seconds 5; Get-Date }
Get-Job
Receive-Job -Job $job -Wait -AutoRemoveJob
```

**Harmonogram (Scheduled Tasks)**
```powershell
$action = New-ScheduledTaskAction -Execute "pwsh.exe" -Argument "-File `"$HOME\Scripts\backup.ps1`""
$trigger = New-ScheduledTaskTrigger -Daily -At 3am
Register-ScheduledTask -TaskName "DailyBackup" -Action $action -Trigger $trigger -Description "Backup"
```

---

## 17) PSReadLine i produktywno≈õƒá

**Historia, podpowiedzi, skr√≥ty**
```powershell
Get-Module PSReadLine
Set-PSReadLineOption -PredictionSource HistoryAndPlugin
# Skr√≥ty: Ctrl+R (search reverse), Alt+Shift+.(argumenty poprzednich polece≈Ñ), F8 (historia z dopasowaniem)
```

**Formatowanie wyj≈õcia**
```powershell
Format-Table Name,Id,CPU -AutoSize
Format-List *               # wszystkie w≈Ça≈õciwo≈õci
```

**Kolumny obliczane (calculated properties)**
```powershell
Get-Process | Select-Object Name, @{N="MB";E={[int]($_.WorkingSet/1MB)}}
```

---

## 18) Czƒôste pu≈Çapki i dobre praktyki

- **Nie** u≈ºywaj `Format-*` w ≈õrodku pipeline‚Äôu, je≈õli planujesz dalszƒÖ obr√≥bkƒô danych.
- Preferuj `Write-Output` (domy≈õlne) zamiast `Write-Host` (tylko do UI).
- U≈ºywaj `-ErrorAction Stop` + `try/catch` dla krytycznych operacji I/O.
- Zawsze podawaj **-Encoding** przy zapisie (`utf8`/`utf8BOM`) ‚Äì unikniesz problem√≥w z polskimi znakami.
- W skryptach preferuj **jawne typy i walidacje** parametr√≥w.
- Przy du≈ºych kolekcjach ‚Äì unikaj czƒôstych konkatenacji tablic, u≈ºywaj list generycznych.
- Do testowania praw dostƒôpu u≈ºywaj `-ErrorAction` + `SilentlyContinue`, ale loguj b≈Çƒôdy dla audytu.
- Dokumentuj parametry w komentarzach, dodawaj **przyk≈Çady u≈ºycia** (`Get-Help` je poka≈ºe).

---

## 19) Mini‚Äëprzepisy (cookbook)

**1. Znajd≈∫ pliki `.Rmd` na C: i D: z obs≈ÇugƒÖ b≈Çƒôd√≥w**
```powershell
"C:\","D:\" | ForEach-Object {
  try {
    Get-ChildItem -Path $_ -Recurse -File -Filter *.Rmd -ErrorAction Stop
  }
  catch {
    Write-Warning "Brak dostƒôpu do: $_"
  }
}
```

**2. Usu≈Ñ logi starsze ni≈º 30 dni (dry‚Äërun + potwierdzenie)**
```powershell
$toDelete = Get-ChildItem .\logs -File -Recurse |
  Where-Object { $_.LastWriteTime -lt (Get-Date).AddDays(-30) }

$toDelete | Select-Object FullName, LastWriteTime

Read-Host "Wpisz YES aby usunƒÖƒá" | Where-Object { $_ -eq "YES" } | ForEach-Object {
  $toDelete | Remove-Item -Force -ErrorAction SilentlyContinue
}
```

**3. Zbierz statystyki rozmiar√≥w plik√≥w w katalogu**
```powershell
Get-ChildItem . -File -Recurse |
  Group-Object Extension | ForEach-Object {
    [PSCustomObject]@{
      Extension = $_.Name
      Count     = $_.Count
      TotalMB   = [math]::Round( ($_.Group | Measure-Object Length -Sum).Sum / 1MB, 2 )
    }
  } | Sort-Object TotalMB -Descending
```

**4. Wczytaj CSV, przefiltruj, wyeksportuj**
```powershell
Import-Csv .\sales.csv |
  Where-Object { [int]$_.Quantity -ge 10 } |
  Sort-Object Amount -Descending |
  Export-Csv .\sales_top.csv -NoTypeInformation -Encoding utf8
```

**5. Poka≈º top 5 proces√≥w po CPU z kolumnƒÖ w MB**
```powershell
Get-Process | Sort-Object CPU -Descending |
  Select-Object -First 5 Name, CPU, @{N="WorkingSetMB";E={[int]($_.WorkingSet/1MB)}} |
  Format-Table -AutoSize
```

---

## 20) Szybka ≈õciƒÖga operator√≥w i alias√≥w

**Operatory por√≥wnania**: `-eq, -ne, -gt, -ge, -lt, -le, -like, -match, -contains, -in, -is`  
**Logiczne**: `-and, -or, -xor, -not`  
**≈öcie≈ºki**: `Join-Path, Split-Path, Resolve-Path, Test-Path`  
**Tekst**: `-replace`, `Substring()`, `ToUpper()`, `-split`, `-join`  
**Alias** (wybrane):  
- `ls` ‚Üí `Get-ChildItem`  
- `cat` ‚Üí `Get-Content`  
- `cp` ‚Üí `Copy-Item`  
- `mv` ‚Üí `Move-Item`  
- `rm` ‚Üí `Remove-Item`  
- `gi` ‚Üí `Get-Item`, `ni` ‚Üí `New-Item`, `ri` ‚Üí `Remove-Item`

---

## 21) Minimalny szablon skryptu produkcyjnego

```powershell
<# 
.SYNOPSIS
  Kr√≥tki opis skryptu
.DESCRIPTION
  D≈Çu≈ºszy opis + za≈Ço≈ºenia
.PARAMETER Path
  Katalog wej≈õciowy
.EXAMPLE
  .\script.ps1 -Path C:\Data -Verbose
#>
[CmdletBinding()]
param(
  [Parameter(Mandatory)]
  [ValidateScript({ Test-Path $_ })]
  [string]$Path,

  [ValidateRange(1,3650)]
  [int]$Days = 365,

  [switch]$WhatIf
)

try {
  $cutoff = (Get-Date).AddDays(-$Days)
  Get-ChildItem -Path $Path -File -Recurse -ErrorAction Stop |
    Where-Object { $_.LastWriteTime -lt $cutoff } |
    ForEach-Object {
      if ($WhatIf) {
        Write-Verbose "UsunƒÖ≈Çbym: $($_.FullName)"
      } else {
        Remove-Item -LiteralPath $_.FullName -Force -ErrorAction Stop
        Write-Verbose "Usuniƒôto: $($_.FullName)"
      }
    }
}
catch {
  Write-Error "B≈ÇƒÖd krytyczny: $($_.Exception.Message)"
  exit 1
}
```

---

**Masz to!** Z tƒÖ ≈õciƒÖgƒÖ wygodnie ogarniesz codziennƒÖ pracƒô w PowerShell: pliki, dane (CSV/JSON), pipeline, funkcje, b≈Çƒôdy, remoting i automatyzacjƒô.
